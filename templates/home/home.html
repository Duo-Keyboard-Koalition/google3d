{% extends "home/home_template.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block home_content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg">
                <div class="card-body">
                    <h1 class="card-title text-center mb-4">{{ title }}</h1>
                    <p class="card-text lead text-center mb-4">{{ description }}</p>
                    <form id="mapOptionsForm" class="mt-4">
                        <div class="mb-4">
                            <h5 class="text-primary mb-3">Map Options</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="showLabels" name="showLabels">
                                        <label class="form-check-label" for="showLabels">
                                            Show labels on map
                                        </label>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="option2" name="option2">
                                        <label class="form-check-label" for="option2">
                                            Enable 3D buildings
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="option3" name="option3">
                                        <label class="form-check-label" for="option3">
                                            Show traffic information
                                        </label>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="option4" name="option4">
                                        <label class="form-check-label" for="option4">
                                            Enable night mode
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-map me-2"></i> View 3D Map
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mapOptionsForm = document.getElementById('mapOptionsForm');

    if (mapOptionsForm) {
        mapOptionsForm.addEventListener('submit', function(e) {
            e.preventDefault();
            redirectToMapWithOptions();
        });
    }
});

function redirectToMapWithOptions() {
    const showLabels = document.getElementById('showLabels').checked;
    const option2 = document.getElementById('option2').checked;
    const option3 = document.getElementById('option3').checked;
    const option4 = document.getElementById('option4').checked;

    // Get user's current location
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;

                // Construct the URL with parameters
                const mapUrl = `{% url 'maps' %}?lat=${lat}&lon=${lon}&showLabels=${showLabels}&option2=${option2}&option3=${option3}&option4=${option4}`;

                // Redirect to the map page
                window.location.href = mapUrl;
            },
            function(error) {
                console.error("Error getting location:", error);
                // Redirect to map page without coordinates if there's an error
                const mapUrl = `{% url 'maps' %}?showLabels=${showLabels}&option2=${option2}&option3=${option3}&option4=${option4}`;
                window.location.href = mapUrl;
            }
        );
    } else {
        console.error("Geolocation is not supported by this browser.");
        // Redirect to map page without coordinates if geolocation is not supported
        const mapUrl = `{% url 'maps' %}?showLabels=${showLabels}&option2=${option2}&option3=${option3}&option4=${option4}`;
        window.location.href = mapUrl;
    }
}
</script>
{% endblock %}